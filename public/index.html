<html>
    <head>
        <title>A2</title>
        <script src="/js/aframe.min.js"></script>
        <script src="/js/aframe-environment-component.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
        <script src="js/dragndrop.js"></script>

        <link rel="stylesheet" href="/css/user-gesture.css">

     
      <script>
        AFRAME.registerComponent('start-experience', {
          init: function () {
            //we can't play sound on some browsers until we have some user interaction
            //this means we should only start playing ambient music after this button is clicked
            console.log('scene loaded');
            document.querySelector('#user-gesture-button').style.display='block';
          }
        });
        
        //function called from user-gesture click
        const startExperience = function() {
          //hide user-gesture overlay
          document.querySelector('#user-gesture-overlay').style.display='none';
          
          //start all ambient music
          const ambientSounds = document.querySelectorAll('.ambient-music');
          ambientSounds.forEach(function(soundEntity) {
            soundEntity.components.sound.playSound();
          });
        }
      </script>

      <script>
          const playBell = function(){
              const sound = document.querySelectorAll('.bell_sound');
              sound.forEach(function(soundEntity){
                  soundEntity.components.sound.playSound();
              });
          }
      </script>

    </head>
    <body>
        <div id="user-gesture-overlay">
            <div class="center">
              <button id="user-gesture-button" onclick="startExperience();">Click here to begin</button>
            </div>
          </div>

<!--AFRAME stuff-->
                
        <a-scene start-experience>
            <a-assets timeout="10000">
                <audio id="city_music_ambient" src="assets/city_ambience.mp3" preload="auto" crossorigin="anonymous"></audio>
            </a-assets>
            
              <!--Mouse & Camera-->
          <a-entity id="camera_main" camera wasd-controls look-controls position="0 1.6 0">
             <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive" ></a-entity>
            <!--<a-cursor super-hands="colliderEvent: raycaster-intersection;"></a-cursor> -->
          </a-entity>

          <audio id="bell" src="assets/cowbell.wav" preload="auto" crossorigin="anonymous"></audio>
            <a-entity class="ambient-music" sound="src:#city_music_ambient; autoplay:false;"></a-entity>
            <!--Play on hit or something-->
            <a-entity class="bell_sound" sound="src:#bell; autoplay:false;"></a-entity>



            <a-entity id="game_buttons">
              <a-entity class="button-start interactive" onclick="startGame(); playBell();"  position="-1 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" 
                    material="color:rgb(100, 255, 100)"
                    animation__mouseenter="property:material.color; type:color; to:rgb(0, 255, 0); startEvents:mouseenter; dur:200"
                    animation__mouseleave="property:material.color; type:color; to:rgb(100, 255, 100); startEvents:mouseleave; dur:200"
                    animation__click="property:position; from:-1 0.55 0; to:-1 0.6 0; startEvents:click; dur:300"></a-entity>
                    <a-entity position="-1 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" ></a-entity>

              <a-entity class="button-end interactive" onclick="endGame();" position="1 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" 
                    material="color:rgb(255, 100, 100)"
                    animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                    animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                    animation__click="property:position; from:1 0.55 0; to:1 0.6 0; startEvents:click; dur:300"></a-entity>
                    <a-entity position="1 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" ></a-entity>
            </a-entity>



            <script>
            

              const startGame = function() {
                  console.log("game start");
                  var box = document.createElement('a-box');
                  box.setAttribute('position',{x:0,y:2,z:-5});
                  box.setAttribute('material',{color:'teal'});
                  box.setAttribute('class','box interactive');
                  box.setAttribute('dragndrop',true);
                  //box.setAttribute('onmousedown','movement();')
                  document.querySelector("a-scene").appendChild(box);
                  //document.querySelector("#camera_main").appendChild(box);
                 
              }

              const movement = function() {
                  console.log("move");
                  var box= document.querySelector("a-box");
                  box.setAttribute('position',{x:0,y:1,z:-5}); 
                  
              }
              
              const endGame = function() {
                console.log("game end");
                var box = document.querySelector("a-box");
                box.parentNode.removeChild(box);
              }

            </script>


            <a-entity id="walls">
              <a-entity class="wall"    geometry="primitive:plane; width:30; height:30;" material="color:blue;" position="15 8 0"  rotation="0 -90 0" shadow="cast:false; receive:true;"></a-entity>
              <a-entity class="wall"    geometry="primitive:plane; width:30; height:30;" material="color:blue;" position="-15 8 0" rotation="0 90 0" shadow="cast:false; receive:true;"></a-entity>
              <a-entity class="wall"    geometry="primitive:plane; width:30; height:30;" material="color:blue;" position="0 8 15"  rotation="0 180 0" shadow="cast:false; receive:true;"></a-entity>
              <a-entity class="wall"    geometry="primitive:plane; width:30; height:30;" material="color:blue;" position="0 8 -15" rotation="0 0 0" shadow="cast:false; receive:true;"></a-entity>
          </a-entity>

            <a-entity environment="preset:default"></a-entity>
        </a-scene>
    </body>
</html>